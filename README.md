### Сервис антифрода
#### Легенда
Сервис принимает набор данных клиента, содержащихся в сторонней системе (хранилище данных). Затем, на основе переданных данных осуществляет проверки правил, препятствующих дальнейшему кредитному скорингу.

#### Требования
- сервис реализует один эндпоинт
- входные данные эндпоинта: дата рождения, номер телефона, история займов (список из объектов, каждый из которых содержит сумму займа, дату его оформления, и флаг закрытия)
- логика эндпоинта:
  - перед осуществлением логики проверки сервис проверяет, есть ли в Redis закэшированный результат проверки полученных данных
  - если результат в Redis есть, сервис возвращает закэшированный результат
  - если результата в Redis нет:
    - сервис делает проверки:
      - если телефон начинает не с +7 (или 8), считаем, что сработал стоп-фактор
      - если клиенту меньше 18 лет, считаем, что сработал стоп-фактор
      - если у клиента есть хотя бы один не закрытый займ, считаем, что сработал стоп-фактор
    - в качестве ответа на эндпоинте сервис возвращает список из не пройденных проверок и итоговый флаг прохождения/не прохождения проверок
    - сервис кэширует полученный результат в Redis

## Используемые технологии
- Python
- FastAPI
- Pydantic
- Redis
- Pytest
- Prometheus
- Grafana
- Docker / Docker Compose

## Доступные адреса
- Swagger UI: http://localhost:8080/docs
- Метрики сервиса: http://localhost:8080/metrics
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000

## Доступные метрики

Общее кол-во запросов
- http_requests_total

Кол-во запросов к антифроду
- antifraud_requests_total

Среднее время HTTP запросов
- rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])

Среднее время обработки антифрода
- rate(antifraud_processing_seconds_sum[5m]) / rate(antifraud_processing_seconds_count[5m])


## Данные для входа в Grafana
- Логин: admin
- Пароль: admin

### Запуск
Из корня проекта выполните команду:
```bash
docker compose up --build
```

### Запуск всех тестов
```bash
pytest src/tests/ -v
```
